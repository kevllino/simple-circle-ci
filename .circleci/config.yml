version: 2.0 # use CircleCI 2.0

base_image: &base_image hashicorp/terraform:light

terraform_init: &terraform_init
  run:
    name: terraform init
    command: |
      terraform init -backend-config="token=${TF_API_TOKEN}"

jobs:
  terraform_plan:
    docker:
      - image: *base_image
    steps:
      - checkout
      - run:
          name: list
          command: |
            ls -l
      - *terraform_init
      - run:
          name: Terraform Plan
          command: |
            terraform plan
workflows:
  version: 2
  build_all:
    jobs:
      - terraform_plan:
          filters:
            branches:
              ignore:
                - master